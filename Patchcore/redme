# 1) 必要物のインストール
python -m pip install "anomalib>=1.0.0" scikit-learn pandas

# 2) データ配置（安全のみで学習）
# dataset/
# ├─ train/normal/        ← 学習は“安全”のみ
# ├─ test/normal/         ← 評価：安全
# └─ test/abnormal/       ← 評価：危険

# 3) 実行
python train_patchcore.py --data ./dataset --out ./runs/patchcore_ladder
python infer_patchcore_confmat.py --data ./dataset --exp ./runs/patchcore_ladder

anomalib train --config /home/yamamao/Patchcore/patchcore_cls.yaml


anomalib --print_config --config /home/yamamao/Patchcore/patchcore_cls.yaml | grep -A2 -n "data:"
anomalib --print_config --config /home/yamamao/Patchcore/patchcore_cls.yaml | grep -n "val_split_mode\|test_split_mode\|root\|normal_dir\|abnormal_dir"

anomalib predict \
  --config /home/yamamao/Patchcore/patchcore_cls.yaml \
  --ckpt_path /home/yamamao/Patchcore/results/Patchcore/ladder_dataset/v8/weights/Lightning/model.ckpt \
  data.root=/home/yamamao/Patchcore/dataset \
  data.test_split_mode=from_dir \
  trainer.default_root_dir=/home/yamamao/Patchcore/pred_results

anomalib predict \
  --config /home/yamamao/Patchcore/patchcore_cls.yaml \
  --ckpt_path /home/yamamao/Patchcore/results/Patchcore/ladder_dataset/v8/weights/Lightning/model.ckpt \
  data.root=/home/yamamao/Patchcore/datase \
  data.normal_dir=normal \
  data.abnormal_dir=abnormal \
  trainer.default_root_dir=/home/yamamao/Patchcore/pred_results

python build_results_and_confmat.py \
  --gt_test_dir /home/yamamao/Patchcore/dataset/test \
  --pred_images_dir /home/yamamao/Patchcore/pred_results/Patchcore/ladder_dataset/latest/images \
  --out_dir /home/yamamao/Patchcore/test_results
